<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JaneDe</title>
    <link rel="icon" href="https://drive.google.com/uc?export=view&id=1WEuzRi6WTE7exBF5W58xL44L0nlzza31" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</head>    
<body>
    <!-- 輪播容器 -->
    <div id="b" class="container d-none">
        <div id="c" class="carousel carousel-slide" data-bs-ride="carousel"></div>
    </div>
    
    <!-- 載入中提示 -->
    <div id="hf" class="p-5 mb-4 bg-light rounded-3 text-center loading-text">
        Jane❤De Diary Loading...
    </div>
    
    <!-- 主標題 -->
    <header id="h" class="p-5 mb-4 bg-light rounded-3 text-center d-none"></header>
    
    <!-- 主內容 -->
    <main id="m" class="container d-none"></main>
    
    <!-- 返回頂部按鈕 -->
    <button id="gt" class="scroll-btn btn-top d-none" aria-label="返回頂部" title="返回頂部">
        ↑
    </button>
    
    <!-- 前往底部按鈕 -->
    <button id="gd" class="scroll-btn btn-bottom" aria-label="前往底部" title="前往底部">
        ↓
    </button>
</body>
<style>
/* 捲動按鈕共用樣式 */
.scroll-btn {
    position: fixed;
    z-index: 90;
    right: 30px;
    bottom: 31px;
    width: 40px;
    height: 40px;
    color: #fff;
    font-size: 20px;
    font-weight: bold;
    opacity: 0.5;
    line-height: 40px;
    border: none;
    border-radius: 50%;
    transition: all 0.3s ease;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.16), 0 2px 10px rgba(0, 0, 0, 0.12);
    cursor: pointer;
}

.scroll-btn:hover {
    opacity: 0.9;
    background: #0099CC !important;
    transform: scale(1.1);
}

.btn-top {
    background: #FFD78C;
}

.btn-bottom {
    background: #FFFF8C;
}

/* 載入動畫 */
.loading-text {
    color: #000;
    font-size: 15px;
    letter-spacing: 3px;
    animation: textAnimation 1s infinite;
}

@keyframes textAnimation {
    0%, 100% {
        text-shadow: none;
    }
    50% {
        text-shadow: 0 0 5px #696969;
    }
}
</style>
<script>
// 全域變數
const API_URL = 'https://script.google.com/macros/s/AKfycbxqMowpUu7nPyUZDXf_mPmzTKK4uBzoBueOrPw0Sdo5bq8ht_HXfMGn5Bz6Bi9hQlho/exec';
const userLang = navigator.language;
const userAgent = navigator.userAgent;
let carouselData = '';
let userIP = '';
let userLocation = '';

// 記錄使用者行為
function logAction(actionCode) {
    if (!userIP) return;
    
    $.ajax({
        url: API_URL,
        data: {
            d: new Date().toLocaleString(),
            i: userIP,
            z: userLocation,
            l: userLang,
            m: userAgent,
            f: actionCode
        }
    });
}

// 切換相簿顯示
function album() {
    logAction(1);
    $('#c').html(carouselData);
    $('#b').slideToggle();
}

// 平滑捲動
function smoothScroll(target) {
    $('html, body').animate({
        scrollTop: target
    }, 'fast');
}

// 初始化捲動按鈕
function initScrollButtons() {
    // 返回頂部
    $('#gt').on('click', function(e) {
        e.preventDefault();
        logAction(2);
        smoothScroll(0);
    });
    
    // 前往底部
    $('#gd').on('click', function(e) {
        e.preventDefault();
        logAction(3);
        smoothScroll($(document).height());
    });
    
    // 監聽捲動事件
    $(window).on('scroll', function() {
        const scrollTop = $(this).scrollTop();
        
        if (scrollTop > 5000) {
            $('#gd').fadeOut();
            $('#gt').fadeIn();
        } else if (scrollTop === 0) {
            logAction(4);
            $('#gt').fadeOut();
            $('#gd').fadeIn();
        }
    });
}

// 載入內容
function loadContent() {
    $.getJSON('https://api.db-ip.com/v2/free/self')
        .done(function(data) {
            userIP = data.ipAddress;
            userLocation = `${data.countryName} / ${data.city} / `;
            
            $.ajax({
                url: API_URL,
                data: {
                    d: new Date().toLocaleString(),
                    i: userIP,
                    z: userLocation,
                    l: userLang,
                    m: userAgent,
                    f: 0
                },
                success: function(response) {
                    const parts = response.split('||');
                    carouselData = parts[0];
                    
                    // 隱藏載入畫面
                    $('#hf').hide();
                    
                    // 顯示內容
                    $('#h').html(parts[1]).removeClass('d-none').hide().fadeIn('slow');
                    $('#m').html(parts[2]).removeClass('d-none').hide().fadeIn('slow');
                    $('#c').fadeIn('slow');
                    
                    // 初始化按鈕
                    initScrollButtons();
                },
                error: function() {
                    alert('載入失敗，請重新整理頁面');
                }
            });
        })
        .fail(function() {
            alert('無法取得位置資訊');
        });
}

// 頁面載入完成後執行
$(document).ready(function() {
    loadContent();
});
</script>
